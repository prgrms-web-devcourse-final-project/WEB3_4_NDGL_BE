<!-- 이 파일은 절대로 기능 구현이 아니며, File의 작동 참고를 위한 예시 파일이다. 추후 삭제할 것!-->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>이미지 조회</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f8f9fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #343a40;
            margin-bottom: 20px;
        }
        
        .info-box {
            background-color: #e7f5ff;
            border: 1px solid #4dabf7;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
            color: #1864ab;
        }
        
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .image-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .image-card img {
            width: 100%;
            aspect-ratio: 4/3;
            object-fit: cover;
            display: block;
        }
        
        .image-card .info {
            padding: 10px;
        }
        
        .image-card .info h3 {
            margin: 0 0 5px 0;
            font-size: 16px;
            color: #343a40;
        }
        
        .image-card .info p {
            margin: 0;
            font-size: 14px;
            color: #6c757d;
        }
        
        .image-card .actions {
            padding: 10px;
            background-color: #f8f9fa;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: flex-end;
        }
        
        .button {
            background-color: #228be6;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        
        .button.delete {
            background-color: #fa5252;
        }
        
        .button:hover {
            opacity: 0.9;
        }
        
        .no-images {
            text-align: center;
            padding: 40px;
            background-color: white;
            border-radius: 8px;
            color: #868e96;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>이미지 조회 - 게시글 #<span th:text="${postId}"></span></h1>
        
        <div class="info-box">
            <p>이 페이지는 게시글의 이미지를 조회하는 화면입니다. 업로드는 API를 통해 진행됩니다.</p>
            <p>예시 API 호출: <code>POST /api/images/presigned-url</code>로 Presigned URL을 발급 받은 후, 해당 URL로 직접 이미지를 업로드합니다.</p>
        </div>
        
        <!-- 이미지 그리드 -->
        <div class="image-grid" th:if="${!images.isEmpty()}">
            <div class="image-card" th:each="image : ${images}">
                <img th:src="${image.url}" alt="이미지">
                <div class="info">
                    <h3>이미지 정보</h3>
                    <p>ID: <span th:text="${image.id}"></span></p>
                    <p>등록일: <span th:text="${#temporals.format(image.createdAt, 'yyyy-MM-dd HH:mm')}"></span></p>
                </div>
                <div class="actions">
                    <button class="button delete" th:onclick="'deleteImage(' + ${image.id} + ')'">삭제</button>
                </div>
            </div>
        </div>
        
        <div class="no-images" th:if="${images.isEmpty()}">
            <h2>등록된 이미지가 없습니다</h2>
            <p>API를 통해 이미지를 업로드해주세요.</p>
        </div>
        
        <!-- 이미지 업로드 폼 (실제로 동작함) -->
        <div class="form-container">
            <h2>새 이미지 업로드</h2>
            <form th:action="@{/temp/upload/__${postId}__}" method="post" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="files">이미지 선택</label>
                    <input type="file" id="files" name="files" multiple accept="image/*">
                </div>
                <button type="submit" class="upload-btn">업로드</button>
            </form>
        </div>
        
        <!-- S3 삭제 테스트 영역 (새로 추가) -->
        <div class="form-container">
            <h2>S3 삭제 테스트</h2>
            
            <!-- 게시물 폴더 통째로 삭제 테스트 -->
            <div class="form-group">
                <label>게시물 ID 기반 폴더 삭제</label>
                <div style="display: flex; gap: 10px;">
                    <input type="number" id="folderPostId" placeholder="게시물 ID" value="1" min="1">
                    <button type="button" class="delete-btn" onclick="testDeleteFolder()">폴더 삭제</button>
                </div>
            </div>
            
            <!-- URL 기반 객체 삭제 테스트 -->
            <div class="form-group">
                <label>URL 기반 객체 삭제</label>
                <textarea id="urlsToDelete" rows="3" placeholder="S3 URL들 (한 줄에 하나씩)"></textarea>
                <button type="button" class="delete-btn" style="margin-top: 5px;" onclick="testDeleteUrls()">URL 삭제</button>
            </div>
            
            <!-- 결합 삭제 테스트 (S3 + DB) -->
            <div class="form-group">
                <label>결합 삭제 테스트 (S3 + DB)</label>
                <div style="display: flex; gap: 10px;">
                    <input type="number" id="combinedPostId" placeholder="게시물 ID" value="1" min="1">
                    <button type="button" class="delete-btn" onclick="testCombinedDelete()">결합 삭제</button>
                </div>
            </div>
            
            <!-- 테스트 결과 출력 영역 -->
            <div class="form-group">
                <label>테스트 결과</label>
                <div id="testResult" style="padding: 10px; background-color: #f5f5f5; border-radius: 4px; min-height: 50px; max-height: 200px; overflow-y: auto; font-family: monospace;">
                    테스트 결과가 여기에 표시됩니다.
                </div>
            </div>
        </div>
    </div>
    
    <script th:inline="javascript">
        // 게시글 ID
        const postId = [[${postId}]];
        
        // 이미지 삭제 함수
        async function deleteImage(imageId) {
            if (!confirm('이 이미지를 삭제하시겠습니까?')) {
                return;
            }
            
            try {
                const response = await fetch(`/temp/images/${imageId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('이미지가 삭제되었습니다.');
                    window.location.reload();
                } else {
                    alert('이미지 삭제에 실패했습니다.');
                }
            } catch (error) {
                console.error('삭제 오류:', error);
                alert('이미지 삭제 중 오류가 발생했습니다.');
            }
        }
    </script>
    
    <script>
        // 기존 스크립트
        function deleteImage(imageId) {
            if (confirm('정말로 이 이미지를 삭제하시겠습니까?')) {
                
                fetch(`/temp/images/${imageId}`, {
                    method: 'DELETE'
                })
                .then(response => {
                    if (response.ok) {
                        alert("이미지가 삭제되었습니다.");
                        window.location.reload();
                    } else {
                        alert('이미지 삭제 중 오류가 발생했습니다.');
                    }
                })
                .catch(error => {
                    console.error('삭제 요청 중 오류:', error);
                    alert('삭제 요청 중 오류가 발생했습니다.');
                });
            }
        }
        
        // S3 테스트 함수들 (새로 추가)
        // 테스트 결과 표시 함수
        function showResult(message, isError = false) {
            const resultDiv = document.getElementById('testResult');
            const timestamp = new Date().toLocaleTimeString();
            const formattedMessage = `[${timestamp}] ${message}`;
            
            resultDiv.innerHTML = `<div style="color: ${isError ? 'red' : 'green'};">${formattedMessage}</div>` + resultDiv.innerHTML;
        }
        
        // 폴더 삭제 테스트
        function testDeleteFolder() {
            const postId = document.getElementById('folderPostId').value;
            if (!postId) {
                showResult('게시물 ID를 입력해주세요.', true);
                return;
            }
            
            showResult(`게시물 ID ${postId}의 S3 폴더 삭제 요청 중...`);
            
            fetch(`/example/images/test-delete-folder/${postId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showResult(`성공: ${data.message}`);
                } else {
                    showResult(`실패: ${data.message}`, true);
                }
            })
            .catch(error => {
                console.error('S3 폴더 삭제 요청 중 오류:', error);
                showResult(`오류 발생: ${error.message}`, true);
            });
        }
        
        // URL 기반 삭제 테스트
        function testDeleteUrls() {
            const urlsText = document.getElementById('urlsToDelete').value;
            if (!urlsText.trim()) {
                showResult('삭제할 URL을 입력해주세요.', true);
                return;
            }
            
            const urls = urlsText.split('\n').filter(url => url.trim());
            if (urls.length === 0) {
                showResult('유효한 URL을 입력해주세요.', true);
                return;
            }
            
            showResult(`${urls.length}개의 URL 삭제 요청 중...`);
            
            fetch('/example/images/test-delete-urls', {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(urls)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showResult(`성공: ${data.message}`);
                } else {
                    showResult(`실패: ${data.message}`, true);
                }
            })
            .catch(error => {
                console.error('URL 기반 삭제 요청 중 오류:', error);
                showResult(`오류 발생: ${error.message}`, true);
            });
        }
        
        // 결합 삭제 테스트
        function testCombinedDelete() {
            const postId = document.getElementById('combinedPostId').value;
            if (!postId) {
                showResult('게시물 ID를 입력해주세요.', true);
                return;
            }
            
            showResult(`게시물 ID ${postId}의 결합 삭제 요청 중...`);
            
            fetch(`/example/images/test-combined-delete/${postId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showResult(`성공: ${data.message}`);
                } else {
                    showResult(`실패: ${data.message}`, true);
                }
            })
            .catch(error => {
                console.error('결합 삭제 요청 중 오류:', error);
                showResult(`오류 발생: ${error.message}`, true);
            });
        }
    </script>
</body>
</html> 